# Create 3 namespaces
sudo ip netns add ns1
sudo ip netns add ns2
sudo ip netns add ns3

# Create veth pairs
sudo ip link add veth1 type veth peer name veth2
sudo ip link add veth3 type veth peer name veth4

# Connect namespaces with one end of veth pairs
sudo ip link set veth2 netns ns1
sudo ip link set veth3 netns ns2
sudo ip link set veth4 netns ns3

# Assign IP addresses to veth interfaces inside namespaces
sudo ip netns exec ns1 ip addr add 10.0.0.1/24 dev veth2
sudo ip netns exec ns2 ip addr add 10.0.0.2/24 dev veth3

# Assign IP address in the root namespace on veth1 (connect to ns1)
sudo ip addr add 10.0.0.3/24 dev veth1

# Bring up veth interfaces in root namespace and all namespaces
sudo ip link set veth1 up
sudo ip netns exec ns1 ip link set veth2 up
sudo ip netns exec ns1 ip link set lo up

sudo ip netns exec ns2 ip link set veth3 up
sudo ip netns exec ns2 ip link set lo up

sudo ip netns exec ns3 ip link set veth4 up
sudo ip netns exec ns3 ip link set lo up
